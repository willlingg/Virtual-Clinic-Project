{"ast":null,"code":"var _jsxFileName = \"/Users/williamling/Documents/UNI/POST_GRAD/Year 2/Term 2/9323 Porject/virtual-clinic/src/Components/AppointmentContainer/AppointmentContainer.jsx\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport \"./AppointmentContainer.css\";\n\nconst AppointmentContainer = props => {\n  const [appointmentList, setAppointmentList] = useState(null);\n  const [doctorList, setDoctorList] = useState(null);\n  const [ApptLoaded, setApptLoaded] = useState(false);\n  const [docLoaded, setDocLoaded] = useState(false);\n  const [selectedFiles, setSelectedFiles] = useState([]);\n  const fileInput = useRef(null);\n  const patient_id = props.patient_id;\n  useEffect(() => {\n    async function getAppointments() {\n      let appointmentQuery = await fetch(`/patient/get_appointments/${patient_id}`);\n      let appointments = await appointmentQuery.json();\n      appointments.sort((a, b) => new Date(a.diary_date) - new Date(b.diary_date));\n      setAppointmentList(appointments);\n      setApptLoaded(true);\n    }\n\n    getAppointments();\n  }, []);\n  useEffect(() => {\n    async function getDoctors() {\n      try {\n        let docResponse = await fetch(\"/get_doctors\");\n        let doctors = await docResponse.json();\n        setDoctorList(doctors);\n        setDocLoaded(true);\n      } catch (err) {\n        console.log(err);\n      }\n    }\n\n    getDoctors();\n  }, []);\n\n  const getDoctorName = doctor_id => {\n    for (var i = 0; i < doctorList.length; i++) {\n      if (doctorList[i].doctor_id === doctor_id) {\n        return /*#__PURE__*/React.createElement(\"h3\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 49,\n            columnNumber: 11\n          }\n        }, \"Dr. \", doctorList[i].first_name, \" \", doctorList[i].last_name);\n      }\n    }\n  };\n\n  const getDate = appointment => {\n    const dateArray = appointment.diary_date.split(\" \");\n    const date = dateArray.slice(1, 4);\n    var day = dateArray[0];\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 61,\n        columnNumber: 12\n      }\n    }, date.join(\"/\"));\n  };\n\n  const getZoomUrl = appointment => {\n    const zoomUrl = appointment.join_url;\n    return /*#__PURE__*/React.createElement(\"a\", {\n      href: zoomUrl,\n      target: \"_blank\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 7\n      }\n    }, \"Click here to begin your appointment\");\n  };\n\n  function getFormData(object) {\n    const formData = new FormData();\n    Object.keys(object).forEach(key => formData.append(key, object[key]));\n    return formData;\n  }\n\n  const deleteAppointment = appointment_id => {\n    fetch(\"/delete_booking\", {\n      method: \"DELETE\",\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\"\n      },\n      //make sure to serialize your JSON body\n      body: JSON.stringify({\n        patient_id: 1,\n        diary_id: appointment_id\n      })\n    }).then(response => {\n      window.location.reload();\n    });\n  };\n\n  function handeFileClick() {\n    fileInput.current.click();\n  }\n\n  const fileHandler = e => {\n    let files = e.target.files;\n\n    for (var i = 0; i < files.length; i++) {\n      files[i].document_type_id = 3;\n      files[i].description = \"\";\n    }\n\n    setSelectedFiles([...selectedFiles, ...files]);\n  };\n\n  const uploadDocument = event => {\n    let formData = getFormData(selectedFiles[0]);\n    console.log(formData);\n    event.preventDefault(); // const data = new FormData(selectedFiles);\n    // console.log(data);\n\n    fetch(`/upload/${patient_id}`, {\n      method: \"POST\",\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\"\n      },\n      body: formData\n    }); // const formData = new FormData();\n    // selectedFiles.forEach((file) => {\n    //   console.log(file);\n    //   fetch(`/upload/${patient_id}`, {\n    //     method: \"POST\",\n    //     headers: {\n    //       Accept: \"application/json\",\n    //       \"Content-Type\": \"application/json\",\n    //     },\n    //     body: JSON.stringify({\n    //       file: file,\n    //     }),\n    //   }).then((response) => {\n    //     console.log(response);\n    //     // if (response.status === 201) {\n    //     //   setSubmitted(true);\n    //   });\n    // });\n  };\n\n  console.log(selectedFiles);\n\n  const deleteDocument = doc_id => {\n    fetch(`/delete_document`, {\n      method: \"DELETE\",\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        document_id: doc_id\n      })\n    }).then(response => {// if (response.status === 201) {\n      //   setSubmitted(true);\n    });\n  };\n\n  if (ApptLoaded && docLoaded) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"appointment-list\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"patient-appointment-intro\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 11\n      }\n    }, \"Please read carefully\"), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 11\n      }\n    }, \"If you wish to upload any medical information or images such as X-rays or CAT scans, please do so by clicking the 'Upload Files' button and attaching the files you wish to provide the Practitioner\"), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 11\n      }\n    }, \"When it is time for your appointment, please click on the link underneath 'Zoom URL' to begin your video appointment.\")), appointmentList.map(appointment => /*#__PURE__*/React.createElement(\"div\", {\n      className: \"appointment-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"calendar-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      className: \"calendar-pic\",\n      src: \"calendar.png\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"appointment-box\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 17\n      }\n    }, getDate(appointment)), /*#__PURE__*/React.createElement(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 17\n      }\n    }, appointment.time_from, \" - \", appointment.time_to))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"appointment-box\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 15\n      }\n    }, \"Practitioner\"), getDoctorName(appointment.doctor_id)), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"appointment-box\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 15\n      }\n    }, \"Upload Files\"), /*#__PURE__*/React.createElement(\"form\", {\n      // action={\"/upload/\" + patient_id}\n      // method=\"POST\"\n      // enctype=\"multipart/form-data\"\n      // target=\"hiddenFrame\"\n      onSubmit: uploadDocument,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      // style={{ display: \"none\" }}\n      name: \"file\",\n      type: \"file\",\n      multiple: true,\n      ref: fileInput,\n      onChange: e => fileHandler(e),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 17\n      }\n    }, \"Send data!\"))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"appointment-box\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 15\n      }\n    }, \"Zoom URL\"), getZoomUrl(appointment)), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"appointment-box\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 15\n      }\n    }, \"Cancel appointment\"), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: () => {\n        deleteAppointment(appointment.diary_id);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 15\n      }\n    }, \"Cancel your appointment\")))), /*#__PURE__*/React.createElement(\"iframe\", {\n      name: \"hiddenFrame\",\n      width: \"0\",\n      height: \"0\",\n      border: \"0\",\n      style: {\n        display: \"none\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 9\n      }\n    }));\n  } else {\n    return /*#__PURE__*/React.createElement(React.Fragment, null);\n  }\n};\n\nexport default AppointmentContainer;","map":{"version":3,"sources":["/Users/williamling/Documents/UNI/POST_GRAD/Year 2/Term 2/9323 Porject/virtual-clinic/src/Components/AppointmentContainer/AppointmentContainer.jsx"],"names":["React","useState","useEffect","useRef","AppointmentContainer","props","appointmentList","setAppointmentList","doctorList","setDoctorList","ApptLoaded","setApptLoaded","docLoaded","setDocLoaded","selectedFiles","setSelectedFiles","fileInput","patient_id","getAppointments","appointmentQuery","fetch","appointments","json","sort","a","b","Date","diary_date","getDoctors","docResponse","doctors","err","console","log","getDoctorName","doctor_id","i","length","first_name","last_name","getDate","appointment","dateArray","split","date","slice","day","join","getZoomUrl","zoomUrl","join_url","getFormData","object","formData","FormData","Object","keys","forEach","key","append","deleteAppointment","appointment_id","method","headers","Accept","body","JSON","stringify","diary_id","then","response","window","location","reload","handeFileClick","current","click","fileHandler","e","files","target","document_type_id","description","uploadDocument","event","preventDefault","deleteDocument","doc_id","document_id","map","time_from","time_to","display"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport \"./AppointmentContainer.css\";\n\nconst AppointmentContainer = (props) => {\n  const [appointmentList, setAppointmentList] = useState(null);\n  const [doctorList, setDoctorList] = useState(null);\n  const [ApptLoaded, setApptLoaded] = useState(false);\n  const [docLoaded, setDocLoaded] = useState(false);\n  const [selectedFiles, setSelectedFiles] = useState([]);\n\n  const fileInput = useRef(null);\n\n  const patient_id = props.patient_id;\n\n  useEffect(() => {\n    async function getAppointments() {\n      let appointmentQuery = await fetch(\n        `/patient/get_appointments/${patient_id}`\n      );\n      let appointments = await appointmentQuery.json();\n      appointments.sort(\n        (a, b) => new Date(a.diary_date) - new Date(b.diary_date)\n      );\n      setAppointmentList(appointments);\n      setApptLoaded(true);\n    }\n\n    getAppointments();\n  }, []);\n\n  useEffect(() => {\n    async function getDoctors() {\n      try {\n        let docResponse = await fetch(\"/get_doctors\");\n        let doctors = await docResponse.json();\n        setDoctorList(doctors);\n        setDocLoaded(true);\n      } catch (err) {\n        console.log(err);\n      }\n    }\n    getDoctors();\n  }, []);\n\n  const getDoctorName = (doctor_id) => {\n    for (var i = 0; i < doctorList.length; i++) {\n      if (doctorList[i].doctor_id === doctor_id) {\n        return (\n          <h3>\n            Dr. {doctorList[i].first_name} {doctorList[i].last_name}\n          </h3>\n        );\n      }\n    }\n  };\n\n  const getDate = (appointment) => {\n    const dateArray = appointment.diary_date.split(\" \");\n    const date = dateArray.slice(1, 4);\n    var day = dateArray[0];\n    return <div>{date.join(\"/\")}</div>;\n  };\n\n  const getZoomUrl = (appointment) => {\n    const zoomUrl = appointment.join_url;\n    return (\n      <a href={zoomUrl} target=\"_blank\">\n        Click here to begin your appointment\n      </a>\n    );\n  };\n\n  function getFormData(object) {\n    const formData = new FormData();\n    Object.keys(object).forEach((key) => formData.append(key, object[key]));\n    return formData;\n  }\n\n  const deleteAppointment = (appointment_id) => {\n    fetch(\"/delete_booking\", {\n      method: \"DELETE\",\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\",\n      },\n\n      //make sure to serialize your JSON body\n      body: JSON.stringify({\n        patient_id: 1,\n        diary_id: appointment_id,\n      }),\n    }).then((response) => {\n      window.location.reload();\n    });\n  };\n\n  function handeFileClick() {\n    fileInput.current.click();\n  }\n\n  const fileHandler = (e) => {\n    let files = e.target.files;\n\n    for (var i = 0; i < files.length; i++) {\n      files[i].document_type_id = 3;\n      files[i].description = \"\";\n    }\n\n    setSelectedFiles([...selectedFiles, ...files]);\n  };\n\n  const uploadDocument = (event) => {\n    let formData = getFormData(selectedFiles[0]);\n    console.log(formData);\n    event.preventDefault();\n    // const data = new FormData(selectedFiles);\n    // console.log(data);\n    fetch(`/upload/${patient_id}`, {\n      method: \"POST\",\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\",\n      },\n      body: formData,\n    });\n    // const formData = new FormData();\n    // selectedFiles.forEach((file) => {\n    //   console.log(file);\n    //   fetch(`/upload/${patient_id}`, {\n    //     method: \"POST\",\n    //     headers: {\n    //       Accept: \"application/json\",\n    //       \"Content-Type\": \"application/json\",\n    //     },\n    //     body: JSON.stringify({\n    //       file: file,\n    //     }),\n    //   }).then((response) => {\n    //     console.log(response);\n    //     // if (response.status === 201) {\n    //     //   setSubmitted(true);\n    //   });\n    // });\n  };\n\n  console.log(selectedFiles);\n\n  const deleteDocument = (doc_id) => {\n    fetch(`/delete_document`, {\n      method: \"DELETE\",\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        document_id: doc_id,\n      }),\n    }).then((response) => {\n      // if (response.status === 201) {\n      //   setSubmitted(true);\n    });\n  };\n\n  if (ApptLoaded && docLoaded) {\n    return (\n      <div className=\"appointment-list\">\n        <div className=\"patient-appointment-intro\">\n          <h2>Please read carefully</h2>\n          <p>\n            If you wish to upload any medical information or images such as\n            X-rays or CAT scans, please do so by clicking the 'Upload Files'\n            button and attaching the files you wish to provide the Practitioner\n          </p>\n          <p>\n            When it is time for your appointment, please click on the link\n            underneath 'Zoom URL' to begin your video appointment.\n          </p>\n        </div>\n        {appointmentList.map((appointment) => (\n          <div className=\"appointment-container\">\n            <div className=\"calendar-container\">\n              <img className=\"calendar-pic\" src=\"calendar.png\"></img>\n              <div className=\"appointment-box\">\n                <h2>{getDate(appointment)}</h2>\n                <h3>\n                  {appointment.time_from} - {appointment.time_to}\n                </h3>\n              </div>\n            </div>\n            <div className=\"appointment-box\">\n              <h2>Practitioner</h2>\n              {getDoctorName(appointment.doctor_id)}\n            </div>\n            <div className=\"appointment-box\">\n              <h2>Upload Files</h2>\n              <form\n                // action={\"/upload/\" + patient_id}\n                // method=\"POST\"\n                // enctype=\"multipart/form-data\"\n                // target=\"hiddenFrame\"\n                onSubmit={uploadDocument}\n              >\n                <input\n                  // style={{ display: \"none\" }}\n                  name=\"file\"\n                  type=\"file\"\n                  multiple\n                  ref={fileInput}\n                  onChange={(e) => fileHandler(e)}\n                ></input>\n                <button>Send data!</button>\n                {/* <input type=\"submit\" value=\"Submit\" /> */}\n              </form>\n              {/* <button onClick={handeFileClick}>Choose Files</button> */}\n              {/* <button onClick={uploadDocument}>Submit</button> */}\n            </div>\n            <div className=\"appointment-box\">\n              <h2>Zoom URL</h2>\n              {getZoomUrl(appointment)}\n            </div>\n            <div className=\"appointment-box\">\n              <h2>Cancel appointment</h2>\n              <button\n                onClick={() => {\n                  deleteAppointment(appointment.diary_id);\n                }}\n              >\n                Cancel your appointment\n              </button>\n            </div>\n          </div>\n        ))}\n        <iframe\n          name=\"hiddenFrame\"\n          width=\"0\"\n          height=\"0\"\n          border=\"0\"\n          style={{ display: \"none\" }}\n        ></iframe>\n      </div>\n    );\n  } else {\n    return <></>;\n  }\n};\n\nexport default AppointmentContainer;\n"]},"metadata":{},"sourceType":"module"}